mainName <- paste(currentdate,names(totaldeaths[countryNumber]))
datsetone <- as.numeric(time_covid19CountryPerc[names(totaldeaths[countryNumber]),])
thedates <- colnames(time_covid19CountryPerc)[datsetone > 0.0]
thedates <- str_replace(thedates,"X","")
thedates <- str_replace_all(thedates,"\\.","/")
thedates <- as.Date(thedates,"%m/%d/%Y")
thedates <- as.Date(str_replace(thedates,"0020-","2020-"))
datsetone <- datsetone[datsetone > 0.0]
datsetchangep <- c(datsetone[1],datsetone[2:length(datsetone)]-datsetone[1:(length(datsetone)-1)])
lastobs <- length(datsetone)
datsetchangen <- c(datsetone[2:length(datsetone)]-datsetone[1:(length(datsetone)-1)],datsetchangep[lastobs])
datsetchange <- 0.5*(datsetchangep + datsetchangen)
datsetchange <- 0.65*datsetchange +
0.35*c(datsetchangep[1],0.5*(datsetone[3:lastobs]-datsetone[1:(length(datsetone)-2)]),datsetchange[lastobs])
datasetone <- as.data.frame(cbind(days=c(1:length(datsetone)),fatalities = datsetone,newfatalities = datsetchange))
lastobs <- nrow(datasetone);
numdays <- min(nrow(datasetone),which.max(datasetone$newfatalities)+7)
startday <- max(1,numdays - daysWindow)
daysrange <- c(startday:lastobs)
cdffit <- logisitcfit(datasetone[daysrange,],-0.1,numdays,5)
daystopeak <- cdffit$to-lastobs
if (daystopeak <= 1)
{
pstartday <- max(1,lastobs - 2.0*daysWindow)
#    pstartday <- max(1,lastobs - daysWindow)
pdaysrange <- c(pstartday:lastobs)
cdffit <- logisitcfit(datasetone[pdaysrange,],cdffit$ro,cdffit$to,5)
}
datasetOptimist <- datasetone;
maxgain <- min(0.9/max(datasetOptimist$fatalities),optGain);
athedates <- thedates[c(1:length(thedates)) %% 7 == 1]
if (!inherits(cdffit, "try-error"))
{
predictedTotalCases <- logisticcdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust;
ymax <- max(1,max(predictedTotalCases))
names(predictedTotalCases) <- thedates
plot(predictedTotalCases,
ylim=c(0,ymax),
type="l",
lty=2,
ylab="Fraction of the Total Expected Fatalities",
xaxt="none",
xlab="",
main=mainName)
lines(datasetone$days[c(1:lastobs)],datasetone$fatalities[c(1:lastobs)],lwd=5)
lines(datasetone$days[c(1:lastobs)],10*datasetone$newfatalities[c(1:lastobs)],lty=3,lwd=4,col=2)
predictedTotalNewCases <- logisticpdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust
lines(10*predictedTotalNewCases,lty=4,col="red")
dmax <- which.max(predictedTotalNewCases)
daystopeak <- cdffit$to-lastobs;
if (daystopeak <= 0)
{
daystopeak <- min(cdffit$to,which.max(datasetone$newfatalities))-lastobs;
}
peakdate <- thedates[lastobs] + as.integer(daystopeak)
text(dmax + 10,0.95,
paste("Days to peak:", sprintf("%3.0f",daystopeak)),
cex=0.8)
abline(v=dmax,col="red",lty=2)
axis(1,at=c(7*(0:(length(athedates)-1)),lastobs,lastobs+as.integer(daystopeak)),labels=c(athedates,thedates[lastobs],peakdate),las=2,cex.axis=0.75)
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalCases)
text(100,0.55,
paste("Current Deaths:", sprintf("%3.0f",max(time_covid19Country[names(totaldeaths[countryNumber]),]))),
cex=0.8)
text(100,0.5,
paste("Total Expected Deaths:", sprintf("%3.0f",expfat)),
cex=0.8)
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalNewCases)
expfat <- max(expfat,datsetchange)
text(100,0.45,
paste("Maximum deaths per day:", sprintf("%3.0f",expfat)),
cex=0.8)
if (numdays ==  lastobs)
{
datasetOptimist <- datasetone;
maxgain <- min(0.9/max(datasetOptimist$fatalities),optGain);
datasetOptimist$fatalities <- maxgain*datasetOptimist$fatalities;
datasetOptimist$newfatalities <- maxgain*datasetOptimist$newfatalities;
cdffit2 <- logisitcfit(datasetOptimist[daysrange,],-0.1,cdffit$to,10)
predictedTotalNewCases <- logisticpdf(c(1:120),cdffit2$ro,cdffit2$to)/cdffit2$adjust
#    predictedTotalNewCases <- logisticpdf(c(1:120),cdffit2$ro,cdffit2$to)
predictedTotalCases <- logisticcdf(c(1:120),cdffit2$ro,cdffit2$to)/cdffit2$adjust;
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalCases)/maxgain
text(100,0.4,
paste("Optimistic Deaths:", sprintf("%3.0f",expfat)),
cex=0.8)
lines(10*predictedTotalNewCases/maxgain,lty=5,lwd=2,col="pink")
dmax <- which.max(predictedTotalNewCases)
daystopeak <- cdffit2$to-lastobs;
text(dmax - 12,
0.95,
paste("Optimistic peak:",sprintf("%3.0f",daystopeak)),
cex=0.8,
col="pink")
abline(v=dmax,col="pink")
}
thepeakdates <- c(thedates[lastobs],thedates[lastobs])
for (endDay in c(7,14,21,28))
{
if (daystopeak <= 0 )
{
numdays <- lastobs + daystopeak;
}
else
{
numdays <- lastobs;
}
ndays <- numdays - endDay
thepeakdates <- c(thepeakdates,thedates[numdays] - endDay)
if (ndays > 7)
{
startday <- max(1,ndays - daysWindow)
daysrange <- c(startday:ndays)
cdffit <- logisitcfit(datasetone[daysrange,],-0.1,ndays,2)
if (!inherits(cdffit, "try-error"))
{
newcases <- logisticpdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust;
lines(10*newcases,lty=6,col=(endDay+14)/7,lwd= 1)
}
}
}
}
else
{
plot(datasetone$days[c(1:ndays)],datasetone$fatalities[c(1:ndays)],
ylim=c(0,1.0),
type="l",
lty=2,
xlab="days",
ylab="% Fatalities",
main=mainName)
}
thepeakdates <- as.character(thepeakdates)
thepeakdates[1] <- paste("Estimated New")
thepeakdates[2] <- paste("Optimistic New")
legend("topright",
legend = c("Total Estimated","Total Observed","New Fatalities",thepeakdates),
col = c(1,1,2,2,"pink",3,4,5,6),
lty = c(2,1,3,4,5,6,6,6,6),
lwd = c(1,5,4,1,2,1,1,1,1),cex=0.75)
z <- c(0:10)/100;
axis(4, at=10*z,labels=round(z,digits=2),
col.axis="blue", las=2, cex.axis=0.7, tck=-.01)
mtext("Fraction of New Fatalities", cex=0.5,side=4, line=3, cex.lab=0.3, col="black",las=3)
}
par(op)
cn = 3
par(mfrow=c(1,1),cex=0.75,mar=c(6,4,4,5))
for (cn in c(1:length(totaldeaths)))
{
thepeakdates <- character(6);
countryNumber <- cn
mainName <- paste(currentdate,names(totaldeaths[countryNumber]))
datsetone <- as.numeric(time_covid19CountryPerc[names(totaldeaths[countryNumber]),])
thedates <- colnames(time_covid19CountryPerc)[datsetone > 0.0]
thedates <- str_replace(thedates,"X","")
thedates <- str_replace_all(thedates,"\\.","/")
thedates <- as.Date(thedates,"%m/%d/%Y")
thedates <- as.Date(str_replace(thedates,"0020-","2020-"))
datsetone <- datsetone[datsetone > 0.0]
datsetchangep <- c(datsetone[1],datsetone[2:length(datsetone)]-datsetone[1:(length(datsetone)-1)])
lastobs <- length(datsetone)
datsetchangen <- c(datsetone[2:length(datsetone)]-datsetone[1:(length(datsetone)-1)],datsetchangep[lastobs])
datsetchange <- 0.5*(datsetchangep + datsetchangen)
datsetchange <- 0.65*datsetchange +
0.35*c(datsetchangep[1],0.5*(datsetone[3:lastobs]-datsetone[1:(length(datsetone)-2)]),datsetchange[lastobs])
datasetone <- as.data.frame(cbind(days=c(1:length(datsetone)),fatalities = datsetone,newfatalities = datsetchange))
lastobs <- nrow(datasetone);
numdays <- min(nrow(datasetone),which.max(datasetone$newfatalities)+7)
startday <- max(1,numdays - daysWindow)
daysrange <- c(startday:lastobs)
cdffit <- logisitcfit(datasetone[daysrange,],-0.1,numdays,5)
daystopeak <- cdffit$to-lastobs
if (daystopeak <= 1)
{
pstartday <- max(1,lastobs - 2.0*daysWindow)
#    pstartday <- max(1,lastobs - daysWindow)
pdaysrange <- c(pstartday:lastobs)
cdffit <- logisitcfit(datasetone[pdaysrange,],cdffit$ro,cdffit$to,5)
}
datasetOptimist <- datasetone;
maxgain <- min(0.9/max(datasetOptimist$fatalities),optGain);
athedates <- thedates[c(1:length(thedates)) %% 7 == 1]
if (!inherits(cdffit, "try-error"))
{
predictedTotalCases <- logisticcdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust;
ymax <- max(1,max(predictedTotalCases))
names(predictedTotalCases) <- thedates
plot(predictedTotalCases,
ylim=c(0,ymax),
type="l",
lty=2,
ylab="Fraction of the Total Expected Fatalities",
xaxt="none",
xlab="",
main=mainName)
lines(datasetone$days[c(1:lastobs)],datasetone$fatalities[c(1:lastobs)],lwd=5)
lines(datasetone$days[c(1:lastobs)],10*datasetone$newfatalities[c(1:lastobs)],lty=3,lwd=4,col=2)
predictedTotalNewCases <- logisticpdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust
lines(10*predictedTotalNewCases,lty=4,col="red")
dmax <- which.max(predictedTotalNewCases)
daystopeak <- cdffit$to-lastobs;
#    if (daystopeak <= 0)
#    {
#      daystopeak <- min(cdffit$to,which.max(datasetone$newfatalities))-lastobs;
#    }
peakdate <- thedates[lastobs] + as.integer(daystopeak)
text(dmax + 10,0.95,
paste("Days to peak:", sprintf("%3.0f",daystopeak)),
cex=0.8)
abline(v=dmax,col="red",lty=2)
axis(1,at=c(7*(0:(length(athedates)-1)),lastobs,lastobs+as.integer(daystopeak)),labels=c(athedates,thedates[lastobs],peakdate),las=2,cex.axis=0.75)
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalCases)
text(100,0.55,
paste("Current Deaths:", sprintf("%3.0f",max(time_covid19Country[names(totaldeaths[countryNumber]),]))),
cex=0.8)
text(100,0.5,
paste("Total Expected Deaths:", sprintf("%3.0f",expfat)),
cex=0.8)
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalNewCases)
expfat <- max(expfat,datsetchange)
text(100,0.45,
paste("Maximum deaths per day:", sprintf("%3.0f",expfat)),
cex=0.8)
if (numdays ==  lastobs)
{
datasetOptimist <- datasetone;
maxgain <- min(0.9/max(datasetOptimist$fatalities),optGain);
datasetOptimist$fatalities <- maxgain*datasetOptimist$fatalities;
datasetOptimist$newfatalities <- maxgain*datasetOptimist$newfatalities;
cdffit2 <- logisitcfit(datasetOptimist[daysrange,],-0.1,cdffit$to,10)
predictedTotalNewCases <- logisticpdf(c(1:120),cdffit2$ro,cdffit2$to)/cdffit2$adjust
#    predictedTotalNewCases <- logisticpdf(c(1:120),cdffit2$ro,cdffit2$to)
predictedTotalCases <- logisticcdf(c(1:120),cdffit2$ro,cdffit2$to)/cdffit2$adjust;
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalCases)/maxgain
text(100,0.4,
paste("Optimistic Deaths:", sprintf("%3.0f",expfat)),
cex=0.8)
lines(10*predictedTotalNewCases/maxgain,lty=5,lwd=2,col="pink")
dmax <- which.max(predictedTotalNewCases)
daystopeak <- cdffit2$to-lastobs;
text(dmax - 12,
0.95,
paste("Optimistic peak:",sprintf("%3.0f",daystopeak)),
cex=0.8,
col="pink")
abline(v=dmax,col="pink")
}
thepeakdates <- c(thedates[lastobs],thedates[lastobs])
for (endDay in c(7,14,21,28))
{
if (daystopeak <= 0 )
{
numdays <- lastobs + daystopeak;
}
else
{
numdays <- lastobs;
}
ndays <- numdays - endDay
thepeakdates <- c(thepeakdates,thedates[numdays] - endDay)
if (ndays > 7)
{
startday <- max(1,ndays - daysWindow)
daysrange <- c(startday:ndays)
cdffit <- logisitcfit(datasetone[daysrange,],-0.1,ndays,2)
if (!inherits(cdffit, "try-error"))
{
newcases <- logisticpdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust;
lines(10*newcases,lty=6,col=(endDay+14)/7,lwd= 1)
}
}
}
}
else
{
plot(datasetone$days[c(1:ndays)],datasetone$fatalities[c(1:ndays)],
ylim=c(0,1.0),
type="l",
lty=2,
xlab="days",
ylab="% Fatalities",
main=mainName)
}
thepeakdates <- as.character(thepeakdates)
thepeakdates[1] <- paste("Estimated New")
thepeakdates[2] <- paste("Optimistic New")
legend("topright",
legend = c("Total Estimated","Total Observed","New Fatalities",thepeakdates),
col = c(1,1,2,2,"pink",3,4,5,6),
lty = c(2,1,3,4,5,6,6,6,6),
lwd = c(1,5,4,1,2,1,1,1,1),cex=0.75)
z <- c(0:10)/100;
axis(4, at=10*z,labels=round(z,digits=2),
col.axis="blue", las=2, cex.axis=0.7, tck=-.01)
mtext("Fraction of New Fatalities", cex=0.5,side=4, line=3, cex.lab=0.3, col="black",las=3)
}
# Chunk 1
knitr::opts_chunk$set(collapse = TRUE, error = FALSE, warning = FALSE, message = FALSE,comment = "#>")
library(stringr)
# Chunk 2: parameters
# The expetec %  of deaths in each country
expectedtotalFatalities = 0.7*0.1*0.01
optGain <- 2
# The number of observations used for the trends
daysWindow <- 14
today <- Sys.Date()
currentdate <- paste(as.character(today),":")
# Chunk 3
time_covid19 <- read.csv("~/GitHub/COVID-19/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv", stringsAsFactors=FALSE)
time_covid19[time_covid19$Country.Region=="Korea, South","Country.Region"] <- "South Korea"
time_covid19[time_covid19$Country.Region=="Czechia","Country.Region"] <- "Czech Republic (Czechia)"
time_covid19[time_covid19$Country.Region=="US","Country.Region"] <- "United States"
time_covid19Country <- time_covid19[time_covid19$Province.State == "",]
time_covid19Country$Province.State <- NULL
time_covid19Country$Lat <- NULL
time_covid19Country$Long <- NULL
rownames(time_covid19Country) <- time_covid19Country$Country.Region
time_covid19Country$Country.Region <- NULL
covid19_datapopulation <- read.csv("./Kaggle/covid19_data - population.csv", stringsAsFactors=FALSE)
rownames(covid19_datapopulation) <- paste(covid19_datapopulation$Country,":",sep="")
totalPoulation <- as.numeric(str_replace_all(covid19_datapopulation$Population_2020,",",""))
totalUrbanPoulation <- as.numeric(str_replace_all(covid19_datapopulation$Urban_pop_pct,"\\%",""))/100.0
totalUrbanPoulation[is.na(totalUrbanPoulation)] <- 1.0;
totalUrbanPoulation <- totalPoulation*totalUrbanPoulation
covid19_datapopulation$ExpectedFatalities <- expectedtotalFatalities*(
totalUrbanPoulation +
0.1*(totalPoulation-totalUrbanPoulation)
)
time_covid19CountryPerc <- time_covid19Country
time_covid19CountryPerc <- time_covid19Country/covid19_datapopulation[rownames(time_covid19Country),"ExpectedFatalities"]
expfatalities <- covid19_datapopulation$ExpectedFatalities/1.0e6
names(expfatalities) <- covid19_datapopulation$Country
expfatalities <- expfatalities[order(-expfatalities)]
plot.new()
op <- par(no.readonly = TRUE)
par(mar=c(8,4,4,4),pty="m")
#barplot(expfatalities[1:30],las=2,cex.names =0.70,cex.axis = 0.60,horiz = TRUE,main="Expected Fatalities",xlab="MIllions")
barplot(expfatalities[1:30],las=2,cex.names =0.70,cex.axis = 0.60,main="Expected Fatalities",ylab="Millions")
par(op)
# Chunk 4
Country.Region <- rownames(time_covid19Country)
totaldeaths <- as.numeric(time_covid19Country[,ncol(time_covid19Country)])
names(totaldeaths) <- Country.Region
totaldeaths <- totaldeaths[order(-totaldeaths)]
ydata <- as.numeric(time_covid19Country[names(totaldeaths[1]),])
ydata <- ydata[ydata > 1e-6]
plot(ydata,main="# Fatalities",xlab="Days",ylab="Fatalities",xlim=c(1,ncol(time_covid19Country)))
text(length(ydata)-1,ydata[length(ydata)],names(totaldeaths[1]))
for (ctr in names(totaldeaths[1:30]))
{
ydata <- as.numeric(time_covid19Country[ctr,])
ydata <- ydata[ydata > 1e-6]
lines(ydata)
text(length(ydata)-1,ydata[length(ydata)],ctr)
}
totaldeaths  <- totaldeaths[!is.na(totaldeaths)]
totaldeaths  <- totaldeaths[totaldeaths > 100]
# Chunk 5
source('./logfunctions.r')
par(op)
cn = 3
par(mfrow=c(1,1),cex=0.75,mar=c(6,4,4,5))
for (cn in c(1:length(totaldeaths)))
{
thepeakdates <- character(6);
countryNumber <- cn
mainName <- paste(currentdate,names(totaldeaths[countryNumber]))
datsetone <- as.numeric(time_covid19CountryPerc[names(totaldeaths[countryNumber]),])
thedates <- colnames(time_covid19CountryPerc)[datsetone > 0.0]
thedates <- str_replace(thedates,"X","")
thedates <- str_replace_all(thedates,"\\.","/")
thedates <- as.Date(thedates,"%m/%d/%Y")
thedates <- as.Date(str_replace(thedates,"0020-","2020-"))
datsetone <- datsetone[datsetone > 0.0]
datsetchangep <- c(datsetone[1],datsetone[2:length(datsetone)]-datsetone[1:(length(datsetone)-1)])
lastobs <- length(datsetone)
datsetchangen <- c(datsetone[2:length(datsetone)]-datsetone[1:(length(datsetone)-1)],datsetchangep[lastobs])
datsetchange <- 0.5*(datsetchangep + datsetchangen)
datsetchange <- 0.65*datsetchange +
0.35*c(datsetchangep[1],0.5*(datsetone[3:lastobs]-datsetone[1:(length(datsetone)-2)]),datsetchange[lastobs])
datasetone <- as.data.frame(cbind(days=c(1:length(datsetone)),fatalities = datsetone,newfatalities = datsetchange))
lastobs <- nrow(datasetone);
numdays <- min(nrow(datasetone),which.max(datasetone$newfatalities)+7)
startday <- max(1,numdays - daysWindow)
daysrange <- c(startday:lastobs)
cdffit <- logisitcfit(datasetone[daysrange,],-0.1,numdays,5)
daystopeak <- cdffit$to-lastobs
if (daystopeak <= 1)
{
pstartday <- max(1,lastobs - 2.0*daysWindow)
#    pstartday <- max(1,lastobs - daysWindow)
pdaysrange <- c(pstartday:lastobs)
cdffit <- logisitcfit(datasetone[pdaysrange,],cdffit$ro,cdffit$to,5)
}
datasetOptimist <- datasetone;
maxgain <- min(0.9/max(datasetOptimist$fatalities),optGain);
athedates <- thedates[c(1:length(thedates)) %% 7 == 1]
if (!inherits(cdffit, "try-error"))
{
predictedTotalCases <- logisticcdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust;
ymax <- max(1,max(predictedTotalCases))
names(predictedTotalCases) <- thedates
plot(predictedTotalCases,
ylim=c(0,ymax),
type="l",
lty=2,
ylab="Fraction of the Total Expected Fatalities",
xaxt="none",
xlab="",
main=mainName)
lines(datasetone$days[c(1:lastobs)],datasetone$fatalities[c(1:lastobs)],lwd=5)
lines(datasetone$days[c(1:lastobs)],10*datasetone$newfatalities[c(1:lastobs)],lty=3,lwd=4,col=2)
predictedTotalNewCases <- logisticpdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust
lines(10*predictedTotalNewCases,lty=4,col="red")
dmax <- which.max(predictedTotalNewCases)
daystopeak <- cdffit$to-lastobs;
#    if (daystopeak <= 0)
#    {
#      daystopeak <- min(cdffit$to,which.max(datasetone$newfatalities))-lastobs;
#    }
peakdate <- thedates[lastobs] + as.integer(daystopeak+0.5)
text(dmax + 10,0.95,
paste("Days to peak:", sprintf("%3.0f",daystopeak)),
cex=0.8)
abline(v=dmax,col="red",lty=2)
axis(1,at=c(7*(0:(length(athedates)-1)),lastobs,lastobs+as.integer(daystopeak)),labels=c(athedates,thedates[lastobs],peakdate),las=2,cex.axis=0.75)
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalCases)
text(100,0.55,
paste("Current Deaths:", sprintf("%3.0f",max(time_covid19Country[names(totaldeaths[countryNumber]),]))),
cex=0.8)
text(100,0.5,
paste("Total Expected Deaths:", sprintf("%3.0f",expfat)),
cex=0.8)
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalNewCases)
expfat <- max(expfat,datsetchange)
text(100,0.45,
paste("Maximum deaths per day:", sprintf("%3.0f",expfat)),
cex=0.8)
if (numdays ==  lastobs)
{
datasetOptimist <- datasetone;
maxgain <- min(0.9/max(datasetOptimist$fatalities),optGain);
datasetOptimist$fatalities <- maxgain*datasetOptimist$fatalities;
datasetOptimist$newfatalities <- maxgain*datasetOptimist$newfatalities;
cdffit2 <- logisitcfit(datasetOptimist[daysrange,],-0.1,cdffit$to,10)
predictedTotalNewCases <- logisticpdf(c(1:120),cdffit2$ro,cdffit2$to)/cdffit2$adjust
#    predictedTotalNewCases <- logisticpdf(c(1:120),cdffit2$ro,cdffit2$to)
predictedTotalCases <- logisticcdf(c(1:120),cdffit2$ro,cdffit2$to)/cdffit2$adjust;
expfat <- covid19_datapopulation[names(totaldeaths[countryNumber]),"ExpectedFatalities"]*max(predictedTotalCases)/maxgain
text(100,0.4,
paste("Optimistic Deaths:", sprintf("%3.0f",expfat)),
cex=0.8)
lines(10*predictedTotalNewCases/maxgain,lty=5,lwd=2,col="pink")
dmax <- which.max(predictedTotalNewCases)
daystopeak <- cdffit2$to-lastobs;
text(dmax - 12,
0.95,
paste("Optimistic peak:",sprintf("%3.0f",daystopeak)),
cex=0.8,
col="pink")
abline(v=dmax,col="pink")
}
thepeakdates <- c(thedates[lastobs],thedates[lastobs])
for (endDay in c(7,14,21,28))
{
if (daystopeak <= 0 )
{
numdays <- lastobs + daystopeak;
}
else
{
numdays <- lastobs;
}
ndays <- numdays - endDay
thepeakdates <- c(thepeakdates,thedates[numdays] - endDay)
if (ndays > 7)
{
startday <- max(1,ndays - daysWindow)
daysrange <- c(startday:ndays)
cdffit <- logisitcfit(datasetone[daysrange,],-0.1,ndays,2)
if (!inherits(cdffit, "try-error"))
{
newcases <- logisticpdf(c(1:120),cdffit$ro,cdffit$to)/cdffit$adjust;
lines(10*newcases,lty=6,col=(endDay+14)/7,lwd= 1)
}
}
}
}
else
{
plot(datasetone$days[c(1:ndays)],datasetone$fatalities[c(1:ndays)],
ylim=c(0,1.0),
type="l",
lty=2,
xlab="days",
ylab="% Fatalities",
main=mainName)
}
thepeakdates <- as.character(thepeakdates)
thepeakdates[1] <- paste("Estimated New")
thepeakdates[2] <- paste("Optimistic New")
legend("topright",
legend = c("Total Estimated","Total Observed","New Fatalities",thepeakdates),
col = c(1,1,2,2,"pink",3,4,5,6),
lty = c(2,1,3,4,5,6,6,6,6),
lwd = c(1,5,4,1,2,1,1,1,1),cex=0.75)
z <- c(0:10)/100;
axis(4, at=10*z,labels=round(z,digits=2),
col.axis="blue", las=2, cex.axis=0.7, tck=-.01)
mtext("Fraction of New Fatalities", cex=0.5,side=4, line=3, cex.lab=0.3, col="black",las=3)
}
